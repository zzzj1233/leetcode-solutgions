<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.project.xf.mapper.XfBaseSiteMapper">

    <resultMap type="com.ruoyi.project.xf.domain.XfBaseSite" id="XfBaseSiteResult">
        <result property="id" column="id"/>
        <result property="siteName" column="site_name"/>
        <result property="siteCode" column="site_code"/>
        <result property="siteAddress" column="site_address"/>
        <result property="longitude" column="longitude"/>
        <result property="latitude" column="latitude"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="area" column="area"/>
        <result property="street" column="street"/>
        <result property="state" column="state"/>
    </resultMap>

    <insert id="saveBatch" parameterType="XfBaseSite">
        insert into xf_base_site
        (site_code,site_name,site_address,province,city,area,street,create_time,state)
        VALUES
        <foreach collection="siteList" item="item" separator=",">
            (#{item.siteCode},#{item.siteName}, #{item.siteAddress},#{item.province},#{item.city},#{item.area},#{item.street},now(),#{item.state})
        </foreach>
    </insert>


    <sql id="selectXfBaseSiteVo">
        select id,
               site_code,
               site_name,
               site_address,
               province,
               city,
               area,
               street,
               longitude,
               latitude,
               create_time,
               update_time,
               state,
               province,
               city,
               area,
               street
        from xf_base_site
    </sql>

    <sql id="selectSiteVo">
        select id, site_code, site_name
        from xf_base_site
    </sql>

    <sql id="selectSiteAreaVo">
        select id, site_code, site_name, province, city, area, street
        from xf_base_site
    </sql>

    <select id="count" resultType="int">
        select count(*)
        from xf_base_site
    </select>

    <select id="queryListBySiteIds" resultMap="XfBaseSiteResult">
        <include refid="selectXfBaseSiteVo"/>
        <if test="siteIds!=null ">
            where id in
            <foreach collection="siteIds" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
    </select>

    <select id="selectSiteList" parameterType="Site" resultType="com.ruoyi.project.xf.domain.Site">
        SELECT
        <if test="search_type==1 ">
            distinct province
        </if>
        <if test="search_type==2 ">
            distinct city
        </if>
        <if test="search_type==3">
            distinct area
        </if>
        <if test="search_type==4">
            distinct street
        </if>
        <if test="search_type!=1 and search_type!=2 and search_type!=3 and search_type!=4">
            id,site_name
        </if>
        from xf_base_site where state=1
        <if test="province != null  and province != '' and search_type==1">and province like concat(#{province}, '%')</if>
        <if test="province != null  and province != '' and search_type!=1">and province = #{province}</if>
        <if test="city != null  and city != '' and search_type!=1 and search_type==2">and city like concat(#{city}, '%')</if>
        <if test="city != null  and city != '' and search_type!=1 and search_type!=2">and city = #{city}</if>
        <if test="area != null  and area != '' and search_type!=1 and search_type!=2 and search_type==3">and area like concat(#{area}, '%')</if>
        <if test="area != null  and area != '' and search_type!=1 and search_type!=2 and search_type!=3">and area = #{area}</if>
        <if test="street != null  and street != '' and search_type!=1 and search_type!=2 and search_type!=3 and search_type==4">and street like concat(#{street}, '%')</if>
        <if test="street != null  and street != '' and search_type!=1 and search_type!=2 and search_type!=3 and search_type!=4">and street = #{street}</if>
        <if test="site_name != null  and site_name != '' and search_type!=1 and search_type!=2 and search_type!=3 and search_type!=4">and site_name like concat(#{site_name}, '%')
        </if>
    </select>

    <select id="selectXfBaseSiteList" parameterType="XfBaseSite" resultMap="XfBaseSiteResult">
        <include refid="selectXfBaseSiteVo"/>
        <where>
            <if test="siteName != null  and siteName != ''">and site_name like concat('%', #{siteName}, '%')</if>
            <if test="siteAddress != null  and siteAddress != ''">and site_address like concat('%', #{siteAddress}, '%')</if>
            <if test="province != null  and province != ''">and province like concat('%', #{province}, '%')</if>
            <if test="city != null  and city != ''">and city like concat('%', #{city}, '%')</if>
            <if test="area != null  and area != ''">and area like concat('%', #{area}, '%')</if>
            <if test="street != null  and street != ''">and street like concat('%', #{street}, '%')</if>
            <if test="longitude != null ">and longitude = #{longitude}</if>
            <if test="latitude != null ">and latitude = #{latitude}</if>
            <if test="state != null ">and state = #{state}</if>
        </where>
        ORDER BY id DESC
    </select>

    <select id="checkXfBaseSite" parameterType="XfBaseSite" resultMap="XfBaseSiteResult">
        <include refid="selectXfBaseSiteVo"/>
        <where>
            <if test="siteName != null  and siteName != ''">and site_name = #{siteName}</if>
            <if test="siteAddress != null  and siteAddress != ''">and site_address = #{siteAddress}</if>
            <if test="province != null  and province != ''">and province = #{province}</if>
            <if test="city != null  and city != ''">and city = #{city}</if>
            <if test="area != null  and area != ''">and area = #{area}</if>
            <if test="street != null  and street != ''">and street = #{street}</if>
            <if test="longitude != null ">and longitude = #{longitude}</if>
            <if test="latitude != null ">and latitude = #{latitude}</if>
            <if test="state != null ">and state = #{state}</if>
        </where>
        limit 0,1
    </select>

    <select id="selectXfBaseSiteById" parameterType="Long" resultMap="XfBaseSiteResult">
        <include refid="selectXfBaseSiteVo"/>
        where id = #{id}
    </select>

    <select id="selectXfBaseSiteByCode" parameterType="String" resultMap="XfBaseSiteResult">
        <include refid="selectXfBaseSiteVo"/>
        where site_code = #{site_code}
    </select>

    <select id="selectSiteNameByNameIn" resultMap="XfBaseSiteResult">
        select id,site_name
        from xf_base_site
        where site_name in
        <foreach collection="collection" separator="," item="item" open="(" close=")">
            #{item}
        </foreach>
    </select>

    <select id="selectProvince" resultType="java.lang.String">
        select distinct province
        from xf_base_site
    </select>

    <select id="selectCity" resultType="java.lang.String">
        select distinct city
        from xf_base_site
        where province = #{province}
    </select>

    <select id="selectArea" resultType="java.lang.String">
        select distinct area
        from xf_base_site
        where province = #{province}
          and city = #{city}
    </select>

    <select id="selectStreet" resultType="java.lang.String">
        select distinct street
        from xf_base_site
        where province = #{province}
          and city = #{city}
          and area = #{area}
    </select>

    <select id="selectSite" resultType="com.ruoyi.project.xf.domain.XfBaseSite">
        select distinct site_name as siteName, id
        from xf_base_site
        where province = #{province}
          and city = #{city}
          and area = #{area}
          and street = #{street}
    </select>

    <select id="selectSiteIdByLocation" resultType="java.lang.Long">

        select id from xf_base_site

        <where>
            <if test="province != null and province != ''">province = #{province}</if>
            <if test="city != null and city != ''">and city = #{city}</if>
            <if test="area != null and area != ''">and area = #{area}</if>
            <if test="street != null and street != ''">and street = #{street}</if>
        </where>

    </select>

    <select id="selectExistsByLocation" resultType="java.lang.Integer">
        select count(1) from xf_base_site
        <where>
            id = #{siteId}
            <if test="location.province != null and location.province != ''">and province = #{location.province}</if>
            <if test="location.city != null and location.city != ''">and city = #{location.city}</if>
            <if test="location.area != null and location.area != ''">and area = #{location.area}</if>
            <if test="location.street != null and location.street != ''">and street = #{location.street}</if>
        </where>
    </select>

    <select id="selectSiteIdByArea" resultType="java.lang.Long">
        select id
        from xf_base_site
        where area = #{area}
    </select>

    <select id="selectStreetByArea" resultType="java.lang.String">
        select distinct street
        from xf_base_site
        where province = #{province}
          and city = #{city}
          and area = #{area}
    </select>

    <select id="selectStreetNameIdByArea" resultType="com.ruoyi.project.xcx.vo.NameIdVo">
        select id, street as name
        from xf_base_site
        where province = #{province}
          and city = #{city}
          and area = #{area}
        group by street
    </select>

    <resultMap id="StreetMapIdsMap" type="com.ruoyi.project.xcx.bo.StreetMapIds">
        <result property="street" column="street"/>
        <association property="siteIds" javaType="java.lang.Long" column="id"/>
    </resultMap>

    <resultMap id="mapResult" type="java.util.HashMap">
        <result property="key" column="street"/>
        <result property="value" column="id"/>
    </resultMap>

    <select id="selectIdMapByStreet" resultMap="mapResult">
        select street,id
        from xf_base_site
        where
        province = #{province}
        and city = #{city}
        and area = #{area}
        and street in
        <foreach collection="list" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>

    </select>

    <insert id="insertXfBaseSite" parameterType="XfBaseSite" useGeneratedKeys="true" keyProperty="id">
        insert into xf_base_site
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="siteName != null  and siteName != ''">site_name,</if>
            <if test="siteAddress != null  and siteAddress != ''">site_address,</if>
            <if test="province != null  and province != ''">province,</if>
            <if test="city != null  and city != ''">city,</if>
            <if test="area != null  and area != ''">area,</if>
            <if test="street != null  and street != ''">street,</if>
            <if test="longitude != null ">longitude,</if>
            <if test="latitude != null ">latitude,</if>
            <if test="createTime != null ">create_time,</if>
            <if test="updateTime != null ">update_time,</if>
            <if test="siteCode != null ">site_code,</if>
            <if test="state != null ">state,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="siteName != null  and siteName != ''">#{siteName},</if>
            <if test="siteAddress != null  and siteAddress != ''">#{siteAddress},</if>
            <if test="province != null  and province != ''">#{province},</if>
            <if test="city != null  and city != ''">#{city},</if>
            <if test="area != null  and area != ''">#{area},</if>
            <if test="street != null  and street != ''">#{street},</if>
            <if test="longitude != null ">#{longitude},</if>
            <if test="latitude != null ">#{latitude},</if>
            <if test="createTime != null ">#{createTime},</if>
            <if test="updateTime != null ">#{updateTime},</if>
            <if test="siteCode != null ">#{siteCode},</if>
            <if test="state != null ">#{state},</if>
        </trim>
    </insert>

    <update id="updateXfBaseSite" parameterType="XfBaseSite">
        update xf_base_site
        <trim prefix="SET" suffixOverrides=",">
            <if test="siteName != null  and siteName != ''">site_name = #{siteName},</if>
            <if test="siteAddress != null  and siteAddress != ''">site_address = #{siteAddress},</if>
            <if test="province != null  and province != ''">province = #{province},</if>
            <if test="city != null  and city != ''">city = #{city},</if>
            <if test="area != null  and area != ''">area = #{area},</if>
            <if test="street != null  and street != ''">street = #{street},</if>
            <if test="longitude != null ">longitude = #{longitude},</if>
            <if test="latitude != null ">latitude = #{latitude},</if>
            <if test="createTime != null ">create_time = #{createTime},</if>
            <if test="updateTime != null ">update_time = #{updateTime},</if>
            <if test="state != null ">state = #{state},</if>
        </trim>
        where id = #{id}
    </update>

    <select id="checkStreetInArea" resultType="java.lang.Boolean">
        select count(1)
        from xf_base_site
        where area = #{area}
          and street = #{street}
    </select>

    <select id="selectSiteIdByStreet" resultType="java.lang.Long">
        select id
        from xf_base_site
        where street = #{street}
    </select>

    <select id="selectSiteInfoIdByLocation" resultType="com.ruoyi.project.xf.domain.XfBaseSite">

        select id,site_name as siteName from xf_base_site

        <where>
            <if test="province != null and province != ''">province = #{province}</if>
            <if test="city != null and city != ''">and city = #{city}</if>
            <if test="area != null and area != ''">and area = #{area}</if>
            <if test="street != null and street != ''">and street = #{street}</if>
        </where>

    </select>

    <select id="selectSiteInfoByStreetList" resultType="com.ruoyi.project.xcx.vo.NameIdVo">
        select site_name as name,id
        from xf_base_site
        where
        province = #{province}
        and city = #{city}
        and area = #{area}
        and street in
        <foreach collection="list" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <delete id="deleteXfBaseSiteById" parameterType="Long">
        delete
        from xf_base_site
        where id = #{id}
    </delete>

    <delete id="deleteXfBaseSiteByIds" parameterType="String">
        delete from xf_base_site where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>