<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.project.xf.mapper.XfWzCarMaintainMapper">

    <resultMap type="com.ruoyi.project.xf.domain.XfWzCarMaintain" id="XfWzCarMaintainResult">
        <result property="id" column="id"/>
        <result property="carId" column="car_id"/>
        <result property="describe" column="describe"/>
        <result property="pics" column="pics"/>
        <result property="mileage" column="mileage"/>
        <result property="createTime" column="create_time"/>
        <result property="customerId" column="customer_id"/>
        <result property="customerName" column="fullname"/>
        <result property="carName" column="carName"/>
        <result property="mileage" column="mileage"/>
        <result property="outType" column="out_type"/>
        <result property="event" column="event"/>
    </resultMap>

    <sql id="selectXfWzCarMaintainVo">
        select id, car_id, `describe`, pics, create_time, customer_id, mileage
        from xf_wz_car_maintain
    </sql>

    <sql id="selectXfWzInventoryCustomerVoWithOutRecord">
        select maintain.id,
               maintain.car_id,
               maintain.describe,
               maintain.pics,
               maintain.mileage,
               maintain.create_time,
               maintain.customer_id,
               maintain.mileage,
               customer.fullname
        from xf_wz_car_maintain maintain
                 LEFT JOIN xf_user_customer customer ON maintain.customer_id = customer.id
    </sql>

    <sql id="selectXfWzInventoryCustomerVo">
        select maintain.id,
               maintain.car_id,
               maintain.describe,
               maintain.pics,
               maintain.mileage,
               maintain.create_time,
               maintain.customer_id,
               maintain.mileage,
               customer.fullname,
               carOut.event,
               carOut.out_type
        from xf_wz_car_maintain maintain
                 LEFT JOIN xf_user_customer customer ON maintain.customer_id = customer.id
                 LEFT OUTER JOIN xf_wz_car_out as carOut on carOut.car_id = maintain.car_id
    </sql>

    <select id="selectXfWzCarMaintainList" parameterType="XfWzCarMaintain" resultMap="XfWzCarMaintainResult">
        <include refid="selectXfWzCarMaintainVo"/>
        <where>
            <if test="carId != null ">and car_id = #{carId}</if>
            <if test="describe != null  and describe != ''">and `describe` = #{describe}</if>
            <if test="pics != null  and pics != ''">and pics = #{pics}</if>
            <if test="mileage != null  and mileage != ''">and mileage = #{mileage}</if>
            <if test="customerId != null ">and customer_id = #{customerId}</if>
        </where>
        order by create_time desc
    </select>

    <select id="selectXfWzCarMaintainListPage" resultMap="XfWzCarMaintainResult">
        <include refid="selectXfWzInventoryCustomerVoWithOutRecord"/>
        <where>
            <if test="carId != null ">and maintain.car_id = #{carId}</if>
            <if test="describe != null  and describe != ''">and `describe` = #{describe}</if>
            <if test="pics != null  and pics != ''">and pics = #{pics}</if>
            <if test="mileage != null  and mileage != ''">and maintain.mileage = #{mileage}</if>
            <if test="customerId != null ">and maintain.customer_id = #{customerId}</if>
        </where>
        ORDER BY id DESC
        LIMIT #{page},#{limit}
    </select>

    <select id="selectXfWzCarMaintainById" parameterType="Long" resultMap="XfWzCarMaintainResult">
        select wm.id             as id,
               car_id,
               `describe`,
               pics,
               wm.mileage,
               wm.create_time    as create_time,
               wm.customer_id    as customer_id,
               car.license_plate as carName,
               user.fullname     as fullname
        from xf_wz_car_maintain as wm
                 inner join xf_wz_car as car on wm.car_id = car.id
                 inner join xf_user_customer as user
                            on wm.customer_id = user.id
        where wm.id = #{id}
    </select>

    <select id="selectXfWzCarMaintainByCarNo" resultMap="XfWzCarMaintainResult">
        select cm.id as id, car_id, `describe`, mileage, pics, cm.create_time as create_time, customer_id
        from xf_wz_car_maintain as cm
                 inner join xf_wz_car as car
                            on cm.car_id = car.id
        where car.license_plate like concat('%', #{carNo}, '%')
        order by create_time desc
    </select>


    <insert id="insertXfWzCarMaintain" parameterType="com.ruoyi.project.xf.domain.XfWzCarMaintain" useGeneratedKeys="true" keyProperty="id">
        insert into xf_wz_car_maintain
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="carId != null ">car_id,</if>
            <if test="describe != null  and describe != ''">`describe`,</if>
            <if test="pics != null  and pics != ''">pics,</if>
            <if test="createTime != null">create_time,</if>
            <if test="customerId != null ">customer_id,</if>
            <if test="kmText != null ">mileage,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="carId != null ">#{carId},</if>
            <if test="describe != null  and describe != ''">#{describe},</if>
            <if test="pics != null  and pics != ''">#{pics},</if>
            <if test="createTime != null ">#{createTime},</if>
            <if test="customerId != null ">#{customerId},</if>
            <if test="kmText != null ">#{kmText},</if>
        </trim>
    </insert>

    <update id="updateXfWzCarMaintain" parameterType="XfWzCarMaintain">
        update xf_wz_car_maintain
        <trim prefix="SET" suffixOverrides=",">
            <if test="carId != null ">car_id = #{carId},</if>
            <if test="describe != null  and describe != ''">`describe` = #{describe},</if>
            <if test="pics != null  and pics != ''">pics = #{pics},</if>
            <if test="mileage != null  and mileage != ''">mileage = #{mileage},</if>
            <if test="createTime != null  and createTime != ''">create_time = #{createTime},</if>
            <if test="customerId != null ">customer_id = #{customerId},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteXfWzCarMaintainById" parameterType="Long">
        delete
        from xf_wz_car_maintain
        where id = #{id}
    </delete>

    <delete id="deleteXfWzCarMaintainByIds" parameterType="String">
        delete from xf_wz_car_maintain where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>